<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Favorites - MovieMania</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-dark text-light">

  <nav class="navbar navbar-expand-lg navbar-dark bg-black shadow">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">ðŸŽ¬ MovieMania</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <h1>Your Favorites</h1>
    <p class="text-muted">Movies you've saved (stored locally in your browser).</p>

    <div id="favoritesGrid" class="row g-4 mt-3"></div>
  </main>

  <script>
    const favoritesGrid = document.getElementById('favoritesGrid');
    const apiKey = "2296f008";
    const apiUrl = "https://www.omdbapi.com/";

    function getFavorites() {
      return JSON.parse(localStorage.getItem('favorites') || '[]');
    }
    function saveFavorites(arr) {
      localStorage.setItem('favorites', JSON.stringify(arr));
    }

    async function loadFavorites() {
      const fav = getFavorites();
      if (!fav.length) {
        favoritesGrid.innerHTML = '<p class="text-muted">No favorites yet. Add some from the movie page or search results.</p>';
        return;
      }
      favoritesGrid.innerHTML = '<p class="text-center text-muted">Loading favorites...</p>';
      favoritesGrid.innerHTML = '';
      for (let id of fav) {
        try {
          const res = await fetch(`${apiUrl}?i=${id}&apikey=${apiKey}`);
          const data = await res.json();
          if (data.Response === "True") {
            const col = document.createElement('div');
            col.className = 'col-md-3 col-sm-6';
            col.innerHTML = `
              <div class="card bg-black text-light h-100 shadow">
                <img src="${data.Poster !== 'N/A' ? data.Poster : 'https://via.placeholder.com/300x450?text=No+Image'}" class="card-img-top" alt="${data.Title}">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${data.Title}</h5>
                  <p class="card-text">Year: ${data.Year}</p>
                  <div class="mt-auto d-flex gap-2">
                    <a href="movie.html?id=${data.imdbID}" class="btn btn-sm btn-danger w-100">View</a>
                    <button class="btn btn-sm btn-outline-danger removeBtn">Remove</button>
                  </div>
                </div>
              </div>
            `;
            col.querySelector('.removeBtn').addEventListener('click', () => {
              removeFavorite(data.imdbID);
            });
            favoritesGrid.appendChild(col);
          }
        } catch (err) {
          console.error(err);
        }
      }
    }

    function removeFavorite(id) {
      const fav = getFavorites();
      const idx = fav.indexOf(id);
      if (idx !== -1) {
        fav.splice(idx,1);
        saveFavorites(fav);
        loadFavorites();
      }
    }

    loadFavorites();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
